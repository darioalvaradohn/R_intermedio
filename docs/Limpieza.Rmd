---
output:
  html_document: default
  word_document: default
  pdf_document: default
header-includes:
- \usepackage{float}
- \floatstyle{boxed}
- \restylefloat{figure}
---

<div style="display:flex; align-items:center;">
  <h1 style="margin:0;">Limpieza y manejo de datos</h1>
  <img src="Imagenes/HNBI_LOGO1.jpeg" alt="Texto alternativo de la imagen" style="width:100px; margin-left:20px;">
</div>


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

#### Paquetes

```{r, warning=FALSE, message=FALSE}
library(rio)
library(palmerpenguins)
library(tidyverse)
library(lubridate)
library(kableExtra)
```

#### Datos

```{r}
data("penguins")
head(penguins)
```

### Contenido{.tabset .tabset-pills}

#### Funciones del paquete `dplyr`

- `select()`: seleccionar columnas

```{r}
sp_islas <- select(penguins, species, island)
head(sp_islas)
summary(sp_islas)
```

```{r}
pin_sin_sexo <- select(penguins, -sex)
head(pin_sin_sexo)
```

```{r}
numericas <- select(penguins, bill_length_mm:body_mass_g)
head(numericas)
```


- `filter()`: filtrar filas

```{r}
sp_Adelie <- filter(penguins, species == "Adelie")
summary(sp_Adelie)
```

```{r}
masamayor4500 <- filter(penguins, body_mass_g > 4500)
summary(masamayor4500)
```

```{r}
combinado <- filter(penguins, body_mass_g > 4500 & bill_depth_mm < 15)
summary(combinado)
```

- `arrange()`: reordenar filas

```{r}
ordenascend <- arrange(penguins, bill_length_mm)
head(ordenascend)
```

```{r}
ordendescend <- arrange(penguins, desc(bill_length_mm))
head(ordendescend)
```

- `mutate()`: crear nuevas columnas

```{r}
peso_kg <- mutate(penguins, body_mass_kg = body_mass_g / 1000)
head(peso_kg)
```

```{r}
pesos <- mutate(penguins, body_mass_kg = body_mass_g / 1000, body_mass_mg = body_mass_g * 1000, body_mass_lbs = body_mass_kg * 2.20462)
head(pesos)
```

```{r}
medidas <- import("C:/Users/dario/OneDrive/HN_Biology_Investigation/CURSOS/R_basico/docs/data/medidas_personas.csv")
```

```{r}
summary(medidas)
```

```{r}
medidas <- mutate(medidas, IMC = round((peso/(altura/100)^2), digits = 2))
head(medidas)
```

```{r}
medidas <- medidas |>
  mutate(grupo = cut(medidas$peso, breaks = c(min(medidas$peso), 60, 70, 80, 90, max(medidas$peso)), 
                     labels = c("Bajo", "Medio Bajo", "Medio", "Medio Alto", "Alto")))

medidas
```

```{r}
medidas <- medidas |> 
  mutate(grupo = cut(medidas$peso, breaks = c(min(medidas$peso), 60, 70, 80, 90, max(medidas$peso)), 
            labels = c("Bajo", "Medio Bajo", "Medio", "Medio Alto", "Alto"))) |>
  mutate(grupo = paste0(grupo, '-', cut(medidas$altura, breaks = c(min(medidas$altura), 160, 175, max(medidas$altura)),                                 labels = c("Baja", "Media", "Alta"))))

head(medidas)
```

```{r}
medidas <- medidas |> 
  mutate(Comp_corp = cut(medidas$IMC, breaks = c(min(medidas$IMC), 18.5, 25, 30, max(medidas$IMC)), 
            labels = c("Inferior", "Normal", "Superior", "Obesidad")))

head(medidas)
```

- `distinct()`: para ver cuántos niveles tenemos en una variable

```{r}
distinct(medidas, Comp_corp)
```


- `rename()`: cambiar nombre de columnas

```{r}
rename(peso_kg, pesokg = body_mass_kg)
```

```{r}
rename(peso_kg, largo_pico_mm = bill_length_mm, alto_pico_mm = bill_depth_mm, largo_aleta_mm = flipper_length_mm, masa_g = body_mass_g, sexo = sex, peso_kg = body_mass_kg)
```


- `summarise()`: crea un nuevo dataframe con los argumentos que especifiquemos

```{r}
rango_largo_pico <- summarise(penguins, range(na.omit(bill_length_mm)))
rango_largo_pico
```

```{r}
media_largo_aleta <- summarise(penguins, mean(na.omit(flipper_length_mm)))
media_largo_aleta
```

```{r}
medias <- summarise(penguins, aleta = mean(na.omit(flipper_length_mm)), pico = mean(na.omit(bill_length_mm)), masa = mean(na.omit(body_mass_g)))
medias
```

- `group_by()`: agrupar los datos. Muy útil combinado con la función `summarise()`.

```{r}
medias <- penguins %>%
  group_by(species) %>%
  summarise(masa_corporal = mean(na.omit(body_mass_g)))
medias
```

- `mutate_at()` combinado con la función `format()` para cambiar el separador de decimales
 - de punto a coma
```{r}
decimalescoma <- mutate_at(penguins, vars(bill_length_mm, bill_depth_mm), funs(format(.,nsmall=2,decimal.mark=",")))
head(decimalescoma)
```

 - de coma a punto
```{r}
decimalespunto <- mutate_at(penguins, vars(bill_length_mm, bill_depth_mm), funs(format(.,nsmall=2,decimal.mark=".")))
head(decimalespunto)
```

 - para darle formato numérico después de realizar el cambio de separador de decimales
```{r}
decimalespunto <- decimalespunto |>
  mutate_if(is.character, as.numeric)
head(decimalespunto)
```

#### Funciones del paquete `tidyr`

- `drop_na()`: para eliminar los NA

```{r}
drop_na(penguins, flipper_length_mm)
```

```{r}
pin <- penguins |>
  drop_na()
pin
```

- `spread()`:

```{r}
#expandir <- spread(pin, key = "species", value = "flipper_length_mm")
#expandir
```

- `gather()`: 

```{r}
#reunir <- gather(expandir, key = "species", value = "flipper_length_mm", -island, -bill_length_mm, -bill_depth_mm, -body_mass_g, -sex, -year)
#reunir
```


- `unite()`: unión de dos o más columnas en una sola 

```{r}
union <- unite(pin, col = speciesXisland, species, island, sep = "_")
head(union)
```

- `separate()`: separar una columna en varias columnas

```{r}
separar <- separate(union, col = speciesXisland, into = c("species", "island"), sep = "_")
head(separar)
```


- `pivot_wider()`:



- `pivot_longer()`:



#### Manejo de fechas con el paquete `lubridate`

- `as_date()`:

```{r}
pin <- pin |>
  as_date(year)
```


#### Creación y modificación de cuadros con el paquete `kableExtra`


```{r}
cuadro <- kable(medias, digits = 2) |>
  kable_styling("bordered", full_width = FALSE, position = "center", font_size = 16)
cuadro
```

