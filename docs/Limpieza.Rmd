---
output:
  word_document: default
  html_document: default
  pdf_document: default
header-includes:
- \usepackage{float}
- \floatstyle{boxed}
- \restylefloat{figure}
---

<div style="display:flex; align-items:center;">
  <h1 style="margin:0;">Limpieza y manejo de datos</h1>
  <img src="Imagenes/HNBI_LOGO1.jpeg" alt="Texto alternativo de la imagen" style="width:100px; margin-left:20px;">
</div>


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

#### Paquetes

```{r, warning=FALSE, message=FALSE}
library(palmerpenguins)
library(tidyverse)
library(kableExtra)
```

#### Datos

```{r}
data("penguins")
head(penguins)
```

### Contenido{.tabset .tabset-pills}

#### Funciones del paquete `dplyr`

- `select()`: seleccionar columnas

```{r}
sp_islas <- select(penguins, species, island)
head(sp_islas)
summary(sp_islas)
```

```{r}
pin_sin_sexo <- select(penguins, -sex)
head(pin_sin_sexo)
```

```{r}
numericas <- select(penguins, bill_length_mm:body_mass_g)
head(numericas)
```


- `filter()`: filtrar filas

```{r}
sp_Adelie <- filter(penguins, species == "Adelie")
summary(sp_Adelie)
```

```{r}
masamayor4500 <- filter(penguins, body_mass_g > 4500)
summary(masamayor4500)
```

```{r}
combinado <- filter(penguins, body_mass_g > 4500 & bill_depth_mm < 15)
summary(combinado)
```

- `arrange()`: reordenar filas

```{r}
ordenascend <- arrange(penguins, bill_length_mm)
head(ordenascend)
```

```{r}
ordendescend <- arrange(penguins, desc(bill_length_mm))
head(ordendescend)
```

- `mutate()`: crear nuevas columnas

```{r}
peso_kg <- mutate(penguins, body_mass_kg = body_mass_g / 1000)
head(peso_kg)
```

```{r}
pesos <- mutate(penguins, body_mass_kg = body_mass_g / 1000, body_mass_mg = body_mass_g * 1000, body_mass_lbs = body_mass_kg * 2.20462)
head(pesos)
```


- `rename()`: cambiar nombre de columnas

```{r}
rename(peso_kg, pesokg = body_mass_kg)
```

```{r}
rename(peso_kg, largo_pico_mm = bill_length_mm, alto_pico_mm = bill_depth_mm, largo_aleta_mm = flipper_length_mm, masa_g = body_mass_g, sexo = sex, peso_kg = body_mass_kg)
```


- `summarise()`: crea un nuevo dataframe con los argumentos que especifiquemos

```{r}
rango_largo_pico <- summarise(penguins, range(na.omit(bill_length_mm)))
rango_largo_pico
```

```{r}
media_largo_aleta <- summarise(penguins, mean(na.omit(flipper_length_mm)))
media_largo_aleta
```

```{r}
medias <- summarise(penguins, aleta = mean(na.omit(flipper_length_mm)), pico = mean(na.omit(bill_length_mm)), masa = mean(na.omit(body_mass_g)))
medias
```

- `group_by()`: agrupar los datos. Muy útil combinado con la función `summarise()`.

```{r}
medias <- penguins %>%
  group_by(species) %>%
  summarise(masa_corporal = mean(na.omit(body_mass_g)))
medias
```

- `mutate_at()` combinado con la función `format()` para cambiar el separador de decimales
 - de punto a coma
```{r}
decimalescoma <- mutate_at(penguins, vars(bill_length_mm, bill_depth_mm), funs(format(.,nsmall=2,decimal.mark=",")))
head(decimalescoma)
```

 - de coma a punto
```{r}
decimalespunto <- mutate_at(penguins, vars(bill_length_mm, bill_depth_mm), funs(format(.,nsmall=2,decimal.mark=".")))
head(decimalespunto)
```

 - para darle formato numérico después de realizar el cambio de separador de decimales
```{r}
decimalespunto <- decimalespunto |>
  mutate_if(is.character, as.numeric)
head(decimalespunto)
```

#### Funciones del paquete `tidyr`

- `drop_na()`: para eliminar los NA

```{r}
drop_na(penguins, flipper_length_mm)
```

```{r}
pin <- penguins |>
  drop_na()
pin
```

- `spread()`:

```{r}
#expandir <- spread(pin, key = "species", value = "flipper_length_mm")
#expandir
```

- `gather()`: 

```{r}
#reunir <- gather(expandir, key = "species", value = "flipper_length_mm", -island, -bill_length_mm, -bill_depth_mm, -body_mass_g, -sex, -year)
#reunir
```


- `unite()`: unión de dos o más columnas en una sola 

```{r}
union <- unite(pin, col = speciesXisland, species, island, sep = "_")
head(union)
```

- `separate()`: separar una columna en varias columnas

```{r}
separar <- separate(union, col = speciesXisland, into = c("species", "island"), sep = "_")
head(separar)
```


- `pivot_wider()`:

```{r}
fish_encounters
```


```{r}
pivot_wider(fish_encounters, names_from = station, values_from = seen, values_fill = 0 )
```

```{r}
us_rent_income
```

```{r}
us_rent_income %>%
  pivot_wider(
    names_from = variable,
    values_from = c(estimate, moe)
  )
```

```{r}
us_rent_income %>%
  pivot_wider(
    names_from = variable,
    values_from = c(estimate, moe),
    names_vary = "slowest"
  )
```

```{r}
us_rent_income %>%
  pivot_wider(
    names_from = variable,
    names_sep = ".",
    values_from = c(estimate, moe)
  )
```

```{r}
us_rent_income %>%
  pivot_wider(
    names_from = variable,
    names_glue = "{variable}_{.value}",
    values_from = c(estimate, moe)
  )
```

```{r}
warpbreaks <- as_tibble(warpbreaks[c("wool", "tension", "breaks")])
warpbreaks
```

```{r}
warpbreaks %>%
  pivot_wider(
    names_from = wool,
    values_from = breaks,
    values_fn = mean
  )
```

```{r}
warpbreaks$breaks[1] <- NA
warpbreaks %>%
  pivot_wider(
    names_from = wool,
    values_from = breaks,
    values_fn = ~mean(.x, na.rm = TRUE)
  )
```


- `pivot_longer()`:

```{r}
relig_income
```

```{r}
relig_income %>%
  pivot_longer(!religion, names_to = "income", values_to = "count")
```

```{r}
billboard
```

```{r}
billboard %>%
  pivot_longer(
    cols = starts_with("wk"),
    names_to = "week",
    names_prefix = "wk",
    values_to = "rank",
    values_drop_na = TRUE
  )
```

```{r}
who
```


```{r}
who %>% pivot_longer(
  cols = new_sp_m014:newrel_f65,
  names_to = c("diagnosis", "gender", "age"),
  names_pattern = "new_?(.*)_(.)(.*)",
  values_to = "count"
)
```

```{r}
anscombe
```

```{r}
anscombe %>%
  pivot_longer(
    everything(),
    names_to = c(".value", "set"),
    names_pattern = "(.)(.)"
  )
```


#### Manejo de fechas con el paquete `lubridate`

- `as_date()`:




#### Creación y modificación de cuadros con el paquete `kableExtra`

```{r}
cuadro <- kable_styling(kable(medias, digits = 2), "striped", full_width = FALSE, position = "center", font_size = 12)
cuadro
```

